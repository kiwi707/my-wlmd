<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>自定义物流面单生成器（含时间自定义）</title>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f0f2f5; }
h1 { text-align: center; color: #333; }
label { display: block; margin-top: 5px; }
input, textarea { width: 100%; padding: 5px; margin-bottom: 5px; }
button { padding: 10px 15px; margin: 10px 0; cursor: pointer; }
.container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-top: 20px;}
.waybill { width: 320px; border: 1px solid #333; background: #fff; padding: 10px; box-sizing: border-box; }
.waybill h3 { margin: 0 0 5px 0; font-size: 16px; text-align: center; }
.waybill p { margin: 3px 0; font-size: 14px; }
.tracking { border-top: 1px dashed #999; margin-top: 5px; padding-top: 5px; font-size: 12px; }
.tracking p { margin: 2px 0; }
canvas { display: block; margin: 5px auto; }
@media print {
    body { background: #fff; }
    .container { gap: 0; }
    .waybill { page-break-inside: avoid; }
}
</style>
</head>
<body>

<h1>自定义物流面单生成器（含时间自定义）</h1>

<h2>单条输入</h2>
<label>快递公司: <input id="companyInput" value="顺丰速运"></label>
<label>单号 (不填自动生成): <input id="numberInput"></label>
<label>发货人: <input id="senderInput" value="张三"></label>
<label>发货电话: <input id="senderPhoneInput" value="13800000000"></label>
<label>发货地址: <input id="senderAddressInput" value="北京市朝阳区建国路100号"></label>
<label>收货人: <input id="receiverInput" value="李四"></label>
<label>收货电话: <input id="receiverPhoneInput" value="13900000000"></label>
<label>收货地址: <input id="receiverAddressInput" value="上海市浦东新区世纪大道200号"></label>
<label>物流明细（每行：时间,城市,状态，可空随机生成）:</label>
<textarea id="trackingInput" rows="4" placeholder="格式：时间,城市,状态"></textarea>
<button onclick="generateCustomWaybill()">生成面单</button>

<h2>批量导入 (每行一条，用逗号分隔，最后一列为物流明细，用|分隔)</h2>
<textarea id="batchInput" rows="5" placeholder="快递公司,单号,发货人,发货电话,发货地址,收货人,收货电话,收货地址,物流明细"></textarea>
<button onclick="generateBatchWaybills()">批量生成面单</button>

<button onclick="window.print()">打印所有面单</button>

<div class="container" id="waybillContainer"></div>

<script>
const cities = ["北京","上海","广州","深圳","杭州","成都","南京","武汉","重庆","天津"];
const statuses = ["已揽件","运输中","到达分拣中心","派送中","已签收"];

function randomNumber(length) {
    let num = '';
    for (let i=0;i<length;i++){ num += Math.floor(Math.random()*10); }
    return num;
}

function randomDate(offsetDays) {
    const now = new Date();
    const past = new Date(now.getTime() - Math.random()*offsetDays*24*60*60*1000);
    return past.toLocaleString();
}

function generateTracking(){
    const steps = ["揽件","运输中","到达分拣中心","派送中","已签收"];
    const count = Math.floor(Math.random()*3)+2;
    const tracking=[];
    for(let i=0;i<count;i++){
        tracking.push({time: randomDate(7), status: steps[i%steps.length], city: cities[Math.floor(Math.random()*cities.length)]});
    }
    return tracking;
}

function parseCustomTracking(raw){
    const tracking = [];
    raw.trim().split("\n").forEach(line=>{
        const parts = line.split(",");
        if(parts.length===3){
            tracking.push({time: parts[0].trim(), city: parts[1].trim(), status: parts[2].trim()});
        }
    });
    return tracking;
}

function createWaybill(data, index){
    let tracking = data.tracking && data.tracking.length>0 ? data.tracking : generateTracking();
    let trackingHTML = '<div class="tracking">';
    tracking.forEach(t=>{ trackingHTML += `<p>[${t.time}] ${t.city} - ${t.status}</p>` });
    trackingHTML += '</div>';

    const card = document.createElement('div');
    card.className="waybill";
    card.innerHTML=`
        <h3>${data.company}</h3>
        <p>单号：${data.number}</p>
        <canvas id="barcode${index}"></canvas>
        <p>当前状态：${tracking[tracking.length-1].status}</p>
        <p>发货人：${data.sender} 电话：${data.senderPhone}</p>
        <p>发货地址：${data.senderAddress}</p>
        <p>收货人：${data.receiver} 电话：${data.receiverPhone}</p>
        <p>收货地址：${data.receiverAddress}</p>
        ${trackingHTML}
    `;
    document.getElementById("waybillContainer").appendChild(card);
    JsBarcode(`#barcode${index}`, data.number, {format:"CODE128",width:2,height:40,displayValue:true});
}

function generateCustomWaybill(){
    const rawTracking = document.getElementById("trackingInput").value;
    const data={
        company: document.getElementById("companyInput").value,
        number: document.getElementById("numberInput").value || randomNumber(12),
        sender: document.getElementById("senderInput").value,
        senderPhone: document.getElementById("senderPhoneInput").value,
        senderAddress: document.getElementById("senderAddressInput").value,
        receiver: document.getElementById("receiverInput").value,
        receiverPhone: document.getElementById("receiverPhoneInput").value,
        receiverAddress: document.getElementById("receiverAddressInput").value,
        tracking: rawTracking ? parseCustomTracking(rawTracking) : []
    };
    createWaybill(data, document.getElementsByClassName("waybill").length);
}

function generateBatchWaybills(){
    const lines=document.getElementById("batchInput").value.trim().split("\n");
    lines.forEach(line=>{
        const arr=line.split(",");
        if(arr.length>=8){
            let trackingArr=[];
            if(arr[8]){
                trackingArr=arr[8].split("|").map(t=>{
                    const parts=t.split(",");
                    return {time:parts[0].trim(), city:parts[1].trim(), status:parts[2].trim()};
                });
            }
            const data={
                company:arr[0],
                number:arr[1]||randomNumber(12),
                sender:arr[2],
                senderPhone:arr[3],
                senderAddress:arr[4],
                receiver:arr[5],
                receiverPhone:arr[6],
                receiverAddress:arr[7],
                tracking:trackingArr
            };
            createWaybill(data, document.getElementsByClassName("waybill").length);
        }
    });
}
</script>

</body>
</html>
